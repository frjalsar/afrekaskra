{% extends "base.html" %}
{% load static %}

{% block title %}Sif - Afrekaskrá FRÍ{% endblock %}
{% block content %}
{% verbatim %}
<div class="card ">
  <div class="card-header">
    <div class="row mb-4">
      <div class="col">
    <ul class="nav nav-pills nav-fill card-header-tabs pull-right" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="women-tab" data-toggle="tab" href="#women" role="tab" aria-controls="women"
          aria-selected="true">Konur</a>
      </li>
      <!---->
      <li class="nav-item">
        <a class="nav-link" id="men-tab" data-toggle="tab" href="#men" role="tab" aria-controls="men"
          aria-selected="false">Karlar</a>
      </li>
      <!---->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#outorindoors" role="button"
          aria-haspopup="true" aria-expanded="false">{{outorinText}}</a>
        <div v-on:click="toggle_outin($event)" class="dropdown-menu" id="outorindoorsDropdown">
          <a class="dropdown-item" id="0">Úti</a>
          <a class="dropdown-item" id="1">Inni</a>
        </div>
      </li>
      <!---->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#event" role="button" aria-haspopup="true"
          aria-expanded="false">{{eventText}}</a>
        <div v-on:click="event_change($event)" class="dropdown-menu" id="eventDropdown">
          <a class="dropdown-item" id="74">60 m</a>
          <a class="dropdown-item" id="80">60 m gr. (76,2 cm)</a>
          <a class="dropdown-item" id="82">60 m gr. (84,0 cm)</a>
          <a class="dropdown-item" id="77">60 m gr. (91,4 cm)</a>
          <a class="dropdown-item" id="78">60 m gr. (99,1 cm)</a>
          <a class="dropdown-item" id="75">60 m gr. (106,7cm)</a>
          <a class="dropdown-item" id="6">100 m</a>
          <a class="dropdown-item" id="25">200 m</a>
          <a class="dropdown-item" id="31">300 m</a>
          <a class="dropdown-item" id="44">400 m</a>
          <a class="dropdown-item" id="73">600 m</a>
          <a class="dropdown-item" id="86">800 m</a>
          <a class="dropdown-item" id="18">1500 m</a>
          <a class="dropdown-item" id="28">3000 m</a>
          <a class="dropdown-item" id="57">5000 m</a>
          <a class="dropdown-item" id="52">4x200 m</a>
          <a class="dropdown-item" id="54">4x400 m</a>
          <a class="dropdown-item" id="124">Hástökk</a>
          <a class="dropdown-item" id="125">Hástökk án atr.</a>
          <a class="dropdown-item" id="154">Langstökk</a>
          <a class="dropdown-item" id="155">Langstökk án atr.</a>
          <a class="dropdown-item" id="197">Stangarstökk</a>
          <a class="dropdown-item" id="204">Þrístökk</a>
          <a class="dropdown-item" id="129">Kringlukast (2,0 kg)</a>
          <a class="dropdown-item" id="135">Kringlukast (1,75kg)</a>
          <a class="dropdown-item" id="130">Kringlukast (1,5 kg)</a>
          <a class="dropdown-item" id="131">Kringlukast (1,0 kg)</a>
          <a class="dropdown-item" id="138">Kúluvarp (7,26 kg)</a>
          <a class="dropdown-item" id="139">Kúluvarp (6,00 kg)</a>
          <a class="dropdown-item" id="140">Kúluvarp (5,0 kg)</a>
          <a class="dropdown-item" id="142">Kúluvarp (4,0 kg)</a>
          <a class="dropdown-item" id="144">Kúluvarp (3,0 kg)</a>
          <a class="dropdown-item" id="143">Kúluvarp (2,0 kg)</a>
          <a class="dropdown-item" id="176">Sleggjukast (7,26 kg)</a>
          <a class="dropdown-item" id="183">Sleggjukast (6,0 kg)</a>
          <a class="dropdown-item" id="181">Sleggjukast (5,0 kg)</a>
          <a class="dropdown-item" id="177">Sleggjukast (4,0 kg)</a>
          <a class="dropdown-item" id="178">Sleggjukast (2,0 kg)</a>
          <a class="dropdown-item" id="179">Sleggjukast (3,0 kg)</a>
          <a class="dropdown-item" id="187">Spjótkast (800 gr)</a>
          <a class="dropdown-item" id="189">Spjótkast (600 gr)</a>
          <a class="dropdown-item" id="191">Spjótkast (500 gr)</a>
          <a class="dropdown-item" id="190">Spjótkast (400 gr)</a>
        </div>
      </li>
      <!---->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#activeyear" role="button" aria-haspopup="true"
          aria-expanded="false">{{yearText}}</a>
        <div v-on:click="year_change($event)" class="dropdown-menu" id="activeyearDropdown">
          <a class="dropdown-item" id="0">Öll ár</a>
{% endverbatim %}
          {% for year in YEARS %}
          <a class="dropdown-item" id="{{ year }}">{{ year }}</a>
          {% endfor %}
{% verbatim %}
        </div>
      </li>
      <!---->
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#age" role="button" aria-haspopup="true"
          aria-expanded="false">{{ageText}}</a>
        <div v-on:click="age_change($event)" class="dropdown-menu" id="ageDropdown">
          <a class="dropdown-item" id="00-99">Allir aldursflokkar</a>
          <a class="dropdown-item" id="20-22">20-22 ára</a>
          <a class="dropdown-item" id="18-19">18-19 ára</a>
          <a class="dropdown-item" id="16-17">16-17 ára</a>
          <a class="dropdown-item" id="15-15">15 ára</a>
          <a class="dropdown-item" id="14-14">14 ára</a>
          <a class="dropdown-item" id="13-13">13 ára</a>
          <a class="dropdown-item" id="12-12">12 ára</a>
        </div>
      </li>
      <!---->
    </ul>
  </div>
    </div>
  <div class="row">
  <div class="col">
    <div class="row justify-content-center">
      <div class="col-md-4 col-sm-12 mb-3 text-center">
        <div class="custom-control custom-switch">
          <input v-on:click="toggle_bestbyath($event)" type="checkbox" class="custom-control-input"
            id="customSwitch2" checked>
          <label class="custom-control-label" for="customSwitch2">Birta bara besta afrek íþróttamanns</label>
        </div>
      </div>
      <div class="col-md-4 col-sm-12 mb-3 text-center">
        <div class="custom-control custom-switch">
          <input v-on:click="toggle_legalresults($event)" type="checkbox" class="custom-control-input"
            id="customSwitch1">
          <label class="custom-control-label" for="customSwitch1">Birta ólöglegan árangur</label>
        </div>
      </div>
      <div class="col-md-4 col-sm-12 mb-3 text-center">
        <div class="custom-control custom-switch">
          <input v-on:click="toggle_isl($event)" type="checkbox" class="custom-control-input" id="customSwitch3">
          <label class="custom-control-label" for="customSwitch3">Birta öll þjóðerni</label>
        </div>
      </div>
    </div>
  </div>
  </div>
</div>

  <div class="card-body">
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="women" role="tabpanel" aria-labelledby="women-tab">
        <!-- ------------------------------------------------------------------------------------------------------------------------------------------------- -->
        <table class="table table-striped table-responsive-sm">
          <thead>
            <tr>
              <th class="d-none d-sm-table-cell" scope="col">#</th>
              <th scope="col">Árangur</th>
              <th v-bind:class="{'d-none': !hasWindWomen}" scope="col">Vindur</th>
              <th scope="col">Nafn</th>
              <th class="d-none d-sm-table-cell" scope="col">Aldur</th>
              <th class="d-none d-sm-table-cell" scope="col">Félag</th>
              <th class="d-none d-xl-table-cell" scope="col">Mót</th>
              <th class="d-none d-md-table-cell" scope="col">Dags.</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(competitor, index) in women_data">
              <th class="d-none d-sm-table-cell" scope="row">{{index+1}}</th>
              <td>{{competitor.results}}</td>
              <td v-bind:class="{'d-none': !hasWindWomen}">{{competitor.wind}}</td>
              <td><a v-bind:href="'/keppandi/' + competitor.competitor_code">{{competitor.name}}</a></td>
              <td class="d-none d-sm-table-cell">{{competitor.age}}</td>
              <td class="d-none d-sm-table-cell">{{competitor.club}}</td>
              <td class="d-none d-xl-table-cell"><a
                  v-bind:href="'http://mot.fri.is/MotFRI/SelectedCompetitionResults.aspx?Code=' + competitor.competition_id">{{competitor.competition_name}}</a>
              </td>
              <td class="d-none d-md-table-cell">{{competitor.date}}</td>
            </tr>
          </tbody>
        </table>
        <p align="center">{{women_message}}</p>
        <!-- ------------------------------------------------------------------------------------------------------------------------------------------------- -->
      </div>
      <div class="tab-pane fade" id="men" role="tabpanel" aria-labelledby="men-tab">
        <!-- ------------------------------------------------------------------------------------------------------------------------------------------------- -->
        <table class="table table-striped table-responsive-sm">
          <thead>
            <tr>
              <th class="d-none d-sm-table-cell" scope="col">#</th>
              <th scope="col">Árangur</th>
              <th v-bind:class="{'d-none': !hasWindMen}" scope="col">Vindur</th>
              <th scope="col">Nafn</th>
              <th class="d-none d-sm-table-cell" scope="col">Aldur</th>
              <th class="d-none d-sm-table-cell" scope="col">Félag</th>
              <th class="d-none d-xl-table-cell" scope="col">Mót</th>
              <th class="d-none d-md-table-cell" scope="col">Dags.</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(competitor, index) in men_data">
              <th class="d-none d-sm-table-cell" scope="row">{{index+1}}</th>
              <td>{{competitor.results}}</td>
              <td v-bind:class="{'d-none': !hasWindMen}">{{competitor.wind}}</td>
              <td><a v-bind:href="'/keppandi/' + competitor.competitor_code">{{competitor.name}}</a></td>
              <td class="d-none d-sm-table-cell">{{competitor.age}}</td>
              <td class="d-none d-sm-table-cell">{{competitor.club}}</td>
              <td class="d-none d-xl-table-cell"><a
                  v-bind:href="'http://mot.fri.is/MotFRI/SelectedCompetitionResults.aspx?Code=' + competitor.competition_id">{{competitor.competition_name}}</a>
              </td>
              <td class="d-none d-md-table-cell">{{competitor.date}}</td>
            </tr>
          </tbody>
        </table>
        <p align="center">{{men_message}}</p>
        <!-- ------------------------------------------------------------------------------------------------------------------------------------------------- -->
      </div>
    </div>
  </div>
</div>
{% endverbatim %}
{% endblock %}

{% block scripts %}
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
  integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
  integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<style>
  .dropdown-menu {
    max-height: 500px;
    overflow-y: auto;
    overflow-x: hidden;
}
</style>

{% verbatim %}
<script>
  new Vue({
    el: '#app',
    data() {
      return {
        women_data: null,
        men_data: null,
        women_event: null,
        men_event: null,
        women_message: '',
        men_message: '',

        isBestByAthActive: true,
        isLegalActive: true,
        isISLActive: true,
        //hasWind: false,

        outorinText: 'Inni',
        eventText: 'Langstökk',
        //yearText: '',
        ageText: 'Allir aldursflokkar',

        event_id: 154, // Event_id
        outin: 1, // Outdoor = 0, Indoor = 1
        //gender: 2, // Women = 2, Men = 1
        gender_women: 2,
        gender_men: 1,
        year: new Date().getFullYear(), // Year
        agegroup: '00-99',
        ageStart: 0, // Start age
        ageEnd: 99, // End age
        legal: 1, // Only legal = 1, all = 0
        isl: 0,
        bestbyath: 1,
        busy: false // Icelandic = 0, Everybody = 1
      }
    },
    computed: {
    yearText: function () {
      if (this.year === '0') {
        return 'Öll ár'
      } else {
        return this.year.toString()
      }
    },
    hasWindWomen: function () {
      if (this.outin === '0') {
          // We are outdoor. Does the current selected event have wind?
          if (this.men_event['HasWind'] === 1) {
            return true
          } else {
            return false
          }
        } else {
          return false // We are indoor, no wind
        }
    },
    hasWindMen: function () {
      if (this.outin === '0') {
        if (this.women_event['HasWind'] === 1) {
            return true
          } else {
            return false
          }
        } else {
          return false // We are indoor, no wind
        }
    }
  },
    mounted() {
      this.get_data(null)
    },
    // define methods under the `methods` object
    methods: {
      get_data: function (event) {
        this.busy = true

        this.women_data = []
        this.men_data = []

        women_url = '/api/top_list/' + this.event_id + '/' + this.outin + '/' + this.gender_women + '/' + this.year + '/' + this.ageStart + '/' + this.ageEnd + '/' + this.legal + '/' + this.isl + '/' + this.bestbyath + '/'
        men_url = '/api/top_list/' + this.event_id + '/' + this.outin + '/' + this.gender_men + '/' + this.year + '/' + this.ageStart + '/' + this.ageEnd + '/' + this.legal + '/' + this.isl + '/' + this.bestbyath + '/'

        axios
          .all([axios.get(women_url), axios.get(men_url)]).then(axios.spread((...response) => {
            this.women_data = response[0]['data']['TopList']
            this.men_data = response[1]['data']['TopList']

            this.women_event = response[0]['data']['EventInfo']
            this.men_event = response[1]['data']['EventInfo']

            //console.log(this.women_data)

            //0, # No units!
            //'metrar': 1, # Meters
            //'sek.': 2, # ss,dd
            //'mín.': 3, # mm:ss
            //'klst.': 4, # hh:mm:ss,dd
            //'stig': 5, # Points
            //'Ungl.stig': 6 # Points junior
            //alert(this.women_event['Units'])
            if (this.women_data.length === 0) {
              this.women_message = 'Engin gögn fundust :('
            } else {
              this.women_message = ''
              this.women_data = this.convert_to_timeformat(this.women_event['Units'], this.women_data)
            }
            if (this.men_data.length === 0) {
              this.men_message = 'Engin gögn fundust :('
            } else
            {
              this.men_message = ''
            this.men_data = this.convert_to_timeformat(this.men_event['Units'], this.men_data)
            }
            this.busy = false
          }))
      },
      convert_to_timeformat: function (unit, my_data){

        if ((unit === 3) || (unit === 4)) {
          var dataLen = my_data.length
          for (i = 0; i < dataLen; i++) {
            var f = Number(my_data[i]['results'])
            if (unit === 4) { // This unit has hours
              var h = Math.floor(f/3600)
              f = f - h*3600
            } else {
              var h = 0
            }
            var m = Math.floor(f/60)
            var s = f - m*60

            if (s < 10) {
              s_str = '0' + s.toFixed(2)
            } else {
              s_str = s.toFixed(2)
            }

            if (m < 10) {
              m_str = '0' + m.toFixed(0)
            } else {
              m_str = m.toFixed(0)
            }

            if (h < 10) {
              h_str = '0' + h.toFixed(0)
            } else {
              h_str = h.toFixed(0)
            }

            if (unit === 3) {
              my_data[i]['results'] = m_str + ':' + s_str
            } else {
              my_data[i]['results'] = h_str + ':' + m_str + ':' + s_str
            }
          }
        }

        return my_data
      },
      test: function (event) {
        alert(event.target.id)
        console.log('Hi')
      },
      toggle_outin: function (event) {
        this.outin = event.target.id
        this.outorinText = event.target.textContent

        this.get_data(event)
      },
      toggle_legalresults: function (event) {
        this.isLegalActive = !this.isLegalActive
        if (this.isLegalActive === true) {
          this.legal = 1
        } else {
          this.legal = 0
        }
        this.get_data(event)
      },
      toggle_isl: function (event, isl) {
        this.isISLActive = !this.isISLActive
        if (this.isISLActive === true) {
          this.isl = 0
        } else {
          this.isl = 1
        }
        this.get_data(event)
      },
      toggle_bestbyath: function (event) {
        this.isBestByAthActive = !this.isBestByAthActive
        if (this.isBestByAthActive === true) {
          this.bestbyath = 1
        } else {
          this.bestbyath = 0
        }
        this.get_data(event)
      },
      year_change: function (event) {
        this.year = event.target.id
        //this.yearText = event.target.textContent
        this.get_data(event)
      },
      age_change: function (event) {
        this.agegroup = event.target.id
        this.ageText = event.target.textContent
        const split = this.agegroup.split('-')
        if (split.length === 2) {
          this.ageStart = split[0]
          this.ageEnd = split[1]
        }
        this.get_data(event)
      },
      event_change: function (event) {
        this.event_id = event.target.id
        this.eventText = event.target.textContent
        this.get_data(event)
      }
    }
  })
</script>
{% endverbatim %}
{% endblock %}